{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css" integrity="sha512-10/jx2EXwxxWqCLX/hHth/vu2KY3jCF70dCQB8TSgNjbCVAC/8vai53GfMDrO2Emgwccf2pJqxct9ehpzG+MTw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" type="text/css" href="{% static '/css/bwrite.css' %}">
  <script src="http://code.jquery.com/jquery-latest.min.js"></script>
  <!-- include libraries(jQuery, bootstrap) -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <!-- include summernote css/js -->
  <link href="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote.min.js"></script>
  <title>ANG-GGO</title>
  <script>
    // 1. ì‚¬ì´íŠ¸ GPS ì¶œë ¥
    $(function() {
        const radius = 6371; // ì§€êµ¬ ë°˜ì§€ë¦„ (ë‹¨ìœ„: km)

        // ë‘ ì§€ì  ê°„ì˜ ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜ (Haversine ê³µì‹)
        function getDistance(lat1, lon1, lat2, lon2) {
            const toRad = (value) => (value * Math.PI) / 180;
            const dLat = toRad(lat2 - lat1);
            const dLon = toRad(lon2 - lon1);
            const a = Math.sin(dLat / 2) ** 2 +
                      Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * 
                      Math.sin(dLon / 2) ** 2;
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return radius * c; // ë‹¨ìœ„: km
        }

        // Geolocation APIë¡œ í˜„ì¬ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜´
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(pos) {
                const userLat = pos.coords.latitude;
                const userLon = pos.coords.longitude;

                $('#latitude').html(userLat); // ìœ„ë„
                $('#longitude').html(userLon); // ê²½ë„

                // CSV íŒŒì¼ ì½ê¸°
                $.ajax({
                    url: '/static/ì¢Œí‘œë°ì´í„°.csv', // static í´ë”ì— ìˆëŠ” íŒŒì¼
                    dataType: 'text',
                    success: function(data) {
                        processCSVData(data, userLat, userLon);
                    },
                    error: function() {
                        alert('CSV íŒŒì¼ì„ ì½ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                });
            });
        } else {
            alert("ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” Geolocationì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }

        // CSV ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
        function processCSVData(data, userLat, userLon) {
            const lines = data.split("\n"); // ì¤„ ë‹¨ìœ„ë¡œ ë‚˜ëˆ”
            let nearestLocation = null; // ê°€ì¥ ê°€ê¹Œìš´ ìœ„ì¹˜
            let minDistance = Infinity; // ìµœì†Œ ê±°ë¦¬

            for (let i = 1; i < lines.length; i++) { // ì²« ë²ˆì§¸ ì¤„ì€ í—¤ë”
                const line = lines[i].trim();
                if (line) {
                    const columns = line.split(",");
                    const ì‹œë„ = columns[0];
                    const ì‹œêµ°êµ¬ = columns[1];
                    const ìœ„ë„ = parseFloat(columns[4]);
                    const ê²½ë„ = parseFloat(columns[5]);

                    // ì‚¬ìš©ì ìœ„ì¹˜ì™€ì˜ ê±°ë¦¬ ê³„ì‚°
                    const distance = getDistance(userLat, userLon, ìœ„ë„, ê²½ë„);
                    if (distance < minDistance) {
                        minDistance = distance;
                        nearestLocation = `${ì‹œë„} ${ì‹œêµ°êµ¬}`;
                    }
                }
            }

            // ê°€ì¥ ê°€ê¹Œìš´ ìœ„ì¹˜ ì¶œë ¥
            if (nearestLocation) {
                $("#bgps").val(nearestLocation);
            } else {
                $("#blocation").html("<p>ê·¼ì²˜ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>");
            }
        }
    });// 1ë²ˆ ë

  // 2. ê¸€ì“°ê¸° ìœ íš¨ì„± ê²€ì‚¬
  if("{{wmsg}}"=='1'){
    alert('ê²Œì‹œê¸€ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
    location.href='/board/nboard/'
  }

  $(function(){
      $('.write').click(function(){
          if($('#btitle').val().length<2){
              alert('ê²Œì‹œê¸€ ì œëª©ì€ ë‘ ìë¦¬ ì´ìƒ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
              $('#btitle').focus()
              return false();
          }
          if($('#summernote').val().length<2){
              alert('ê²Œì‹œê¸€ ë‚´ìš©ì€ ë‘ ìë¦¬ ì´ìƒ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
              $('#summernote').focus()
              return false();
          }
          if($('#bgps').val().length<2){
              alert('ìœ„ì¹˜ë¥¼ ì…ë ¥í•´ì•¼ ê²Œì‹œê¸€ ì‘ì„±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
              $('#bgps').focus()
              return false();
          }
          writeFrm.submit();
      });
  });// 2ë²ˆ ë

  // 3. ì¸ë¨¸ë…¸íŠ¸ ì‚½ì…
  $(function(){

      $('#summernote').summernote({
          focus:true,  width:"100%",
          minHeight: 400,           // ì—ë””í„° ìµœì†Œ ë†’ì´
          maxHeight: 500,          // ì—ë””í„° ìµœëŒ€ ë†’ì´
          lang : 'ko-KR',
          placeholder: 'ê¸€ìë¥¼ ì…ë ¥í•˜ì‹œë©´ ë©ë‹ˆë‹¤.' ,
          disableResizeEditor: true,
          //  ì¶”ê°€ ë¶€ë¶„
          toolbar: [
          // [groupName, [list of button]]
          ['fontname', ['fontname']],
          ['fontsize', ['fontsize']],
          ['style', ['bold', 'italic', 'underline','strikethrough', 'clear']],
          ['color', ['forecolor','color']],
          ['table', ['table']],
          ['para', ['ul', 'ol', 'paragraph']],
          ['height', ['height']],
          ['insert',['picture','link','video']],
          ['view', ['fullscreen', 'help']]
          ],
        fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New','ë§‘ì€ ê³ ë”•','ê¶ì„œ','êµ´ë¦¼ì²´','êµ´ë¦¼','ë‹ì›€ì²´','ë°”íƒ•ì²´'],
        fontSizes: ['8','9','10','11','12','14','16','18','20','22','24','28','30','36','50','72'],
        //ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹œ width ì ìš©
        callbacks: {
          onImageUpload: function(image) {
            console.log('in');
            const file = image[0];
            const reader = new FileReader();
            reader.onloadend = function() {
              const image = $('<img>').attr('src',  reader.result);
              image.attr('width','100 %');
              $('#summernote').summernote("insertNode", image[0]);
            }
                reader.readAsDataURL(file);
            }
          }
        });
      });
  </script>
</script>
</head>
<body>
  <!-- í—¤ë” ë¶€ë¶„ -->
  <header>
    <div class="inner">
      <a href="/"><span class="main_logo">ë¡œê³ </span></a>
      <ul>
        <a href="/map/mview/"><li>ì§€ë„</li></a>
        <a href="/foodBoard/foodList/"><li>ë§›ì§‘ì¶”ì²œ</li></a>
        <a href="/board/nboard/"><li>ê²Œì‹œíŒ</li></a>
        <li>ì˜ˆì•½</li>
        <li>ì´ë²¤íŠ¸</li>
        <a href="/Brand/"><li>ë¸Œëœë“œ ì†Œê°œ</li></a>
      </ul>
      <span>
        <button type="button" class="ag_my"><a href="/member/login/">ë¡œê·¸ì¸/íšŒì›ê°€ì…</a></button>
        <button type="button" class="ag_my"><a href="/member/logout/">ë¡œê·¸ì•„ì›ƒ</a></button>
      </span>
    </div>
    <hr>
  </header>

  <!-- ë©”ì¸ ì‹¤í–‰ -->

  <main>
    <div class="here">
      <div class="sub_navloc">HOME&nbsp;&nbsp; <i class="fa-solid fa-chevron-right"></i>&nbsp;&nbsp; ê²Œì‹œíŒ&nbsp;&nbsp; <strong><i class="fa-solid fa-chevron-right"></i>&nbsp;&nbsp; ê²Œì‹œê¸€ ì‘ì„±</strong></div>
    </div>
    <div class="bwrite">
      <form action="" name="writeFrm" id="writeFrm" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <table>
          <colgroup>
            <col width="15%">
            <col width="85%">
          </colgroup>
          <tr>
            <th class="summer">ì‘ì„±ì</th>
            <td>&nbsp;&nbsp;&nbsp;&nbsp;{{request.session.session_nickname}}</td>
          </tr>
          <tr>
            <th class="star">ì œëª©</th>
            <td><input type="text" name="btitle" id="btitle" placeholder="ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."></td>
          </tr>
          <tr>
            <th class="star">ìœ„ì¹˜</th>
            <td id="blocation"><input type="text" name="bgps" id="bgps" value=""></td>
          </tr>
          <tr>
            <th class="star">ì»¤ë®¤ë‹ˆí‹° ì„ íƒ</th>
            <td>
              <select name="bselect" id="community">
                <option value="ì¶”ì²œë§›ì§‘" id="yum">ì¶”ì²œë§›ì§‘ğŸ˜‹</option>
                <option value="ê°ì„±ì¹´í˜" id="cafe">ê°ì„±ì¹´í˜â˜•</option>
                <option value="ì·¨ë¯¸" id="hobby">ì·¨ë¯¸ğŸ®</option>
                <option value="ì›¨ì´íŒ…" id="waiting">ì›¨ì´íŒ…ğŸ‘¥</option>
                <option value="ì‹¤ì‹œê°„ê³µìœ " id="live">ì‹¤ì‹œê°„ê³µìœ ğŸ—«</option>
                <option value="ìƒí™œ/í¸ì˜" id="life">ìƒí™œ/í¸ì˜ğŸ§¼</option>
                <option value="êµí†µ" id="traffic">êµí†µğŸš—</option>
                <option value="í’ê²½" id="scene">í’ê²½ğŸŒ´</option>
                <option value="ì‚¬ê±´ì‚¬ê³ " id="accident">ì‚¬ê±´ì‚¬ê³ ğŸ˜ˆ</option>
                <option value="ê¸°íƒ€" id="etc">ê¸°íƒ€ğŸ”</option>
              </select>
            </td>
          </tr>
          <tr>
            <th class="star">ë‚´ìš©</th>
            <td class="sumcontent">
              <textarea name="bcontent" id="summernote" cols="50" rows="10"></textarea>
            </td>
          </tr>
          <tr>
            <th class="summer">ì´ë¯¸ì§€ í‘œì‹œ</th>
            <td>
              <input type="file" onchange="readURL(this);" name="bfile" id="file">
            </td>
          </tr>
          
          <!-- <tr>
            <th>ì´ë¯¸ì§€ í™•ì¸</th>
            <td id="txt"><img id="preview" src="" style="width: 200px;"></td>
          </tr> -->
        </table>
        <div class="button-wrapper">
          <button type="button" class="write">ì‘ì„±ì™„ë£Œ</button>
          <button type="button" class="cancel" onclick="javascript:location.href='/board/nboard/'">ì·¨ì†Œ</button>
        </div>
      </form>
    </div>
  </main>

  <!-- í•˜ë‹¨ ë¶€ë¶„ -->
  <footer>
    <div class="footer">
      <div class="ftnavi">
        <ul>
          <li><a href="">íšŒì‚¬ì†Œê°œ</a></li>
          <li><a href="">ì˜¤ì‹œëŠ”ê¸¸</a></li>
          <li><a href="">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a></li>
          <li><a href="">ì˜ìƒì •ë³´ì²˜ë¦¬ê¸°ê¸°ìš´ì˜ê´€ë¦¬ë°©ì¹¨</a></li>
          <li><a href="">ì´ìš©ì•½ê´€</a></li>
          <li><a href="">ì´ë©”ì¼ë¬´ë‹¨ìˆ˜ì§‘ê±°ë¶€</a></li>
        </ul>
        <div class="addr">
          <p>í¬ë ˆìŠ¤íŠ¸ ë¦¬ì†œ<span>|</span>ì¶©ì²­ë¶ë„ ì œì²œì‹œ ë°±ìš´ë©´ ê¸ˆë´‰ë¡œ 365</p>
          <p class="tel">ëŒ€í‘œë²ˆí˜¸ : 043-649-6000&nbsp;&nbsp;
          <span>ì˜ˆì•½ë¬¸ì˜ : 1600-0060</span>
          <span>ë‹¨ì²´ë¬¸ì˜ : 02-6177-5999</span>
          <span>ë¶„ì–‘ë¬¸ì˜ : 02-567-5555</span>
          <span>í†µì‹ íŒë§¤ì—…ì‹ ê³  : 2011-ì¶©ë¶ì œì²œ-0016í˜¸</span>
          </p>
          <p>ë©”ë¦¬ì¸ í™”ì¬ì™€ ê°œì¸ì •ë³´ ë°°ìƒì±…ì„ë³´í—˜ ê³„ì•½ì„ ì²´ê²°í•˜ì—¬ íšŒì› ê°œì¸ì •ë³´ë¥¼ ë³´í˜¸í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
          <p class="copy">COPYRIGHT(C) HOBAN HOTEL & RESORT. ALL RIGHTS RESERVED.</p>
        </div>
      </div>
      <div class="right">
        <div class="sns">
        </div>
        <div class="group">
          <select name="site_go" id="site_go" class="sel_box">
            <option value="#">íŒ¨ë°€ë¦¬ì‚¬ì´íŠ¸</option>
            <option value="https://www.ihoban.co.kr/web">í˜¸ë°˜ê±´ì„¤</option>
            <option value="https://www.hobanapt.co.kr/web">í˜¸ë°˜ë² ë¥´ë””ì›€</option>
          </select>
          <button type="button">GO</button>
        </div>
      </div>
    </div>
  </footer>
</body>
</html>